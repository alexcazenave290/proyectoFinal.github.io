<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Adopción de Mascotas</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ===== Encabezado ===== */
        .header {
            width: 420px;
            margin: 24px auto 18px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #b48a5a;
            border-radius: 10px;
            padding: 12px 0;
            min-height: 48px;
        }

        .search-bar {
            width: 80%;
            max-width: 320px;
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            background: #fffbe6;
            font-weight: bold;
            text-align: center;
            outline: none;
            margin-left: 2%;
        }

        /* ===== Cards ===== */
        .cards-grid {
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2.5rem 2rem;
            justify-items: center;
            margin: 2.5rem 0;
        }

        .card {
            background: #b48a5a;
            border-radius: 18px;
            box-shadow: 0 2px 12px #b48a5a55;
            width: 320px;
            margin: 40px auto 0 auto;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: 
                transform 0.35s cubic-bezier(.4,1.5,.6,1),
                box-shadow 0.35s cubic-bezier(.4,1.5,.6,1);
        }

        .card:hover {
            transform: translateY(-16px) scale(1.035) rotate(-2deg);
            box-shadow: 0 8px 32px #b48a5a88;
            z-index: 2;
        }

        .card-header {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            padding: 8px 14px 0 0;
            font-size: 1.2rem;
            color: #5a4326;
        }

        .card-img {
            width: 220px;
            height: 220px;
            object-fit: cover;
            border-radius: 12px;
            margin: 12px auto;
            display: block;
            background: #fff;
            box-shadow: 0 2px 8px #fff8;
        }

        .card-body {
            padding: 10px 18px 18px 18px;
            width: 100%;
            text-align: center;
        }

        .card-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .card-title {
            font-size: 1.3rem;
            color: #2d2d2d;
            margin: 8px 0;
            font-weight: bold;
        }

        .card-user, .card-like {
            font-size: 1.3rem;
        }

        .card-desc {
            font-size: 0.95rem;
            color: #222;
            margin-top: 6px;
        }

        .card-details {
            display: none;
            margin-top: 10px;
            font-size: 0.9rem;
            text-align: left;
            background: #fffbe6;
            border-radius: 8px;
            padding: 8px;
        }

        .card:hover .card-details {
            display: block;
        }

        /* ===== Mensaje cuando no hay mascotas ===== */
        .no-pets-message {
            text-align: center;
            color: #666;
            font-size: 1.2rem;
            margin: 50px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
            width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ===== Patitas animadas detrás ===== */
        #paw-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .paw-bg {
            position: absolute;
            user-select: none;
            animation: flotar 3s ease-in-out infinite;
        }

        @keyframes flotar {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
            50% { transform: translateY(-10px) rotate(10deg); opacity: 1; }
            100% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
        }
    </style>
</head>
<body>
<div class="container-main">
    <aside class="sidebar">
        <div class="logo-menu">
            <img src="./img/logoUpon.png" alt="Logo" class="logo">
            <span class="menu-icon">&#9776;</span>
        </div>
        <nav>
            <ul>
                <li><a href="PestañaDonaciones.html">Donaciones</a></li>
                <li><a href="SobreNosotros.html">Sobre Nosotros</a></li>
                <li><a href="#">Dudas Frecuentes</a></li>
                <li><a href="#">Asociaciones</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <header class="header">
            <input type="text" placeholder="Buscador" class="search-bar" id="searchBar">
            <span class="paw-icon"><i class='bx bx-paw'></i></span>
        </header>

        <div class="background-paws">
            <div class="cards-grid" id="cardsGrid">
                <!-- Las tarjetas se cargarán aquí automáticamente -->
            </div>
        </div>
    </main>
</div>

<!-- Contenedor de patitas -->
<div id="paw-container"></div>

<script>
    const cardsGrid = document.getElementById('cardsGrid');
    const searchBar = document.getElementById('searchBar');
    
    // ===== Configuración =====
    const cantidadPatitas = 15;
    const tamanoMin = 30;
    const tamanoMax = 70;
    const sidebarWidth = 200; 
    const headerHeight = 90;

    // ===== Cargar mascotas desde localStorage =====
    document.addEventListener('DOMContentLoaded', () => {
        cargarMascotas();
        generarPatitas();
        
        // Funcionalidad de búsqueda
        searchBar.addEventListener('input', filtrarMascotas);
    });

    function cargarMascotas() {
        // Obtener mascotas del localStorage (mismo que el primer archivo)
        const pets = JSON.parse(localStorage.getItem("pets")) || [];
        
        if (pets.length === 0) {
            mostrarMensajeVacio();
        } else {
            pets.forEach(pet => crearCard(pet));
        }
    }

    function crearCard(pet) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <div class="card-header">
                <i class='bx bx-heart card-like'></i>
            </div>
            <img src="${pet.image}" class="card-img" alt="${pet.name}">
            <div class="card-body">
                <div class="card-info">
                    <i class='bx bx-user card-user'></i>
                    <div class="card-title">${pet.name}</div>
                    <i class='bx bx-paw'></i>
                </div>
                <div class="card-desc">${pet.desc}</div>
                <div class="card-details">
                    <p><b>Raza:</b> ${pet.raza}</p>
                    <p><b>Especie:</b> ${pet.especie}</p>
                    <p><b>Tamaño:</b> ${pet.tamano}</p>
                    <p><b>Salud:</b> ${pet.salud}</p>
                </div>
            </div>`;
        cardsGrid.appendChild(card);
    }

    function mostrarMensajeVacio() {
        const mensaje = document.createElement("div");
        mensaje.className = "no-pets-message";
        mensaje.innerHTML = `
            <i class='bx bx-sad' style='font-size: 3rem; color: #b48a5a; display: block; margin-bottom: 10px;'></i>
            <h3>No hay mascotas disponibles</h3>
            <p>Ve al formulario de adopción para agregar algunas mascotas.</p>
        `;
        cardsGrid.appendChild(mensaje);
    }

    function filtrarMascotas() {
        const filtro = searchBar.value.toLowerCase();
        const pets = JSON.parse(localStorage.getItem("pets")) || [];
        
        // Limpiar grid
        cardsGrid.innerHTML = '';
        
        if (filtro === '') {
            // Si no hay filtro, mostrar todas
            if (pets.length === 0) {
                mostrarMensajeVacio();
            } else {
                pets.forEach(pet => crearCard(pet));
            }
        } else {
            // Filtrar mascotas
            const petsFiltradas = pets.filter(pet => 
                pet.name.toLowerCase().includes(filtro) ||
                pet.raza.toLowerCase().includes(filtro) ||
                pet.especie.toLowerCase().includes(filtro) ||
                pet.desc.toLowerCase().includes(filtro)
            );
            
            if (petsFiltradas.length === 0) {
                const mensaje = document.createElement("div");
                mensaje.className = "no-pets-message";
                mensaje.innerHTML = `
                    <i class='bx bx-search' style='font-size: 3rem; color: #b48a5a; display: block; margin-bottom: 10px;'></i>
                    <h3>No se encontraron mascotas</h3>
                    <p>No hay mascotas que coincidan con "${filtro}"</p>
                `;
                cardsGrid.appendChild(mensaje);
            } else {
                petsFiltradas.forEach(pet => crearCard(pet));
            }
        }
    }

    function generarPatitas() {
        const container = document.getElementById('paw-container');
        const containerWidth = window.innerWidth - sidebarWidth;
        const containerHeight = window.innerHeight;
        const posiciones = [];

        for(let i=0; i<cantidadPatitas; i++) {
            const paw = document.createElement('img');
            paw.src = 'img/pawBackground.png';
            paw.classList.add('paw-bg');

            const tamano = tamanoMin + Math.random() * (tamanoMax - tamanoMin);
            paw.style.width = `${tamano}px`;
            paw.style.height = `${tamano}px`;

            let x, y, intentos = 0;
            do {
                x = sidebarWidth + Math.random() * (containerWidth - tamano);
                y = headerHeight + Math.random() * (containerHeight - headerHeight - tamano);
                intentos++;
            } while(posiciones.some(p => 
                Math.abs(p.x - x) < (p.size + tamano) && Math.abs(p.y - y) < (p.size + tamano)
            ) && intentos < 100);

            posiciones.push({x, y, size: tamano});
            paw.style.left = `${x}px`;
            paw.style.top = `${y}px`;

            paw.style.animationDuration = `${2 + Math.random()*3}s`;

            container.appendChild(paw);
        }
    }

    // ===== Actualizar automáticamente cuando cambie el localStorage =====
    window.addEventListener('storage', function(e) {
        if (e.key === 'pets') {
            cardsGrid.innerHTML = '';
            cargarMascotas();
        }
    });
</script>

</body>
</html>
